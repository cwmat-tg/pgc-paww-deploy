<app-intro-helper-text
    [header]="this.header"
    [content]="this.content"
></app-intro-helper-text>

<div class="appContactContainer">

    <form [formGroup]="this.animalForm">

        <div
            fxLayout="column"
            fxLayout.xs="column"
            fxLayout.sm="column"
            fxLayoutAlign="start center"
            fxLayoutAlign.xs="start start"
            fxLayoutAlign.sm="start start"
            fxFlex>

            <!-- Date and number of animals -->
            <div
                class="appFieldRow"
                fxLayout="row"
                fxLayout.xs="column"
                fxLayout.sm="column"
                fxLayoutAlign="start center"
                fxLayoutAlign.xs="start start"
                fxLayoutAlign.sm="start start"
                fxFlex>

                <div
                    fxFlex="50"
                    fxFlex.xs="100"
                    fxFlex.sm="100"
                    class="appFormRowContainer">

                    <div class="appFormContainer">
                        <mat-form-field>
                            <mat-label for="observation-date">Date<span class="appRequiredAsterisk">*</span></mat-label>
                            <input matInput id="observation-date" formControlName="date" [max]="this.maxDate" [matDatepicker]="picker">
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                            <mat-hint>Enter the date of observation</mat-hint>
                            <mat-error *ngIf="this.date?.invalid">This field is required and cannot be a future date.</mat-error>
                        </mat-form-field>
                    </div>

                </div>

                <div
                    fxFlex="50"
                    fxFlex.xs="100"
                    fxFlex.sm="100"
                    class="appFormRowContainer">

                    <div class="appFormContainer">
                        <mat-form-field>
                            <mat-label for="observation-numberOfAnimals">Number of Animals<span class="appRequiredAsterisk">*</span></mat-label>
                            <mat-select id="observation-numberOfAnimals" formControlName="numberOfAnimals">
                                <mat-option *ngFor="let animalNum of this.numberOfAnimalsList" [value]="animalNum?.AnimalCountId">
                                    {{animalNum?.Name}}
                                </mat-option>
                            </mat-select>
                            <mat-hint>How many animals did you see?</mat-hint>
                            <mat-error *ngIf="this.numberOfAnimals?.invalid && this.numberOfAnimals?.errors?.required">This field is required.</mat-error>
                        </mat-form-field>
                    </div>

                </div>

            </div>

            <!-- Spacer -->
            <div
                class="appFieldRow"
                fxLayout="row"
                fxLayout.xs="column"
                fxLayout.sm="column"
                fxLayoutAlign="start center"
                fxLayoutAlign.xs="start start"
                fxLayoutAlign.sm="start start"
                fxFlex>

                <mat-divider class="appFullWidth appSpacer"></mat-divider>

            </div>

            <!-- Hidden -->
            <div *ngIf="this.date?.valid && this.numberOfAnimals?.valid" fxLayout="column" [@state]="state" class="appFieldRow appHide appSpaceAtBottom">

                <!-- Species -->
                <div
                    class="appFieldRow"
                    fxLayout="row"
                    fxLayout.xs="column"
                    fxLayout.sm="column"
                    fxLayoutAlign="start center"
                    fxLayoutAlign.xs="start start"
                    fxLayoutAlign.sm="start start"
                    fxFlex>

                    <div
                    fxFlex="50"
                    fxFlex.xs="100"
                    fxFlex.sm="100"
                    class="appFormRowContainer">

                        <div class="appFormContainer">
                            <mat-form-field>
                                <mat-label for="observation-species">Species<span class="appRequiredAsterisk">*</span></mat-label>
                                <input type="text"
                                    placeholder="Type a species name to filter the list"
                                    aria-label="Number"
                                    matInput
                                    formControlName="species"
                                    [matAutocomplete]="auto">
                                <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete" [displayWith]="getSpeciesDisplay">
                                <mat-option *ngFor="let option of filteredSpeciesOptions | async" [value]="option">
                                    {{option?.Name}}
                                </mat-option>
                                </mat-autocomplete>
                                <mat-hint>What species is the majority of the animals that were observed?</mat-hint>
                                <mat-error *ngIf="this.species?.invalid">This field is required and must be selected from the available list.</mat-error>
                            </mat-form-field>
                        </div>

                    </div>

                    <div
                    *ngIf="this.species?.valid"
                    fxFlex="50"
                    fxFlex.xs="100"
                    fxFlex.sm="100"
                    class="appFormRowContainer">

                        <div class="appFormContainer">
                            <app-species-card [species]="this.species?.value"></app-species-card>
                        </div>

                    </div>

                </div>

                <div *ngIf="this.species?.valid" fxLayout="column" [@speciesSelected]="speciesSelected" class="appFieldRow appHide">

                    <!-- Alive -->
                    <div
                        class="appFieldRow"
                        fxLayout="row"
                        fxLayout.xs="column"
                        fxLayout.sm="column"
                        fxLayoutAlign="start center"
                        fxLayoutAlign.xs="start start"
                        fxLayoutAlign.sm="start start"
                        fxFlex>

                        <div
                        fxFlex="50"
                        fxFlex.xs="100"
                        fxFlex.sm="100"
                        class="appFormRowContainer">

                            <div class="appFormContainer">
                                <mat-form-field>
                                    <mat-label for="observation-alive">Alive<span class="appRequiredAsterisk">*</span></mat-label>
                                    <mat-select id="observation-alive" formControlName="alive">
                                        <mat-option *ngFor="let item of this.wildlifeStatusList" [value]="item?.WildlifeStatusId">
                                            {{item?.Name}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-hint>Was the animal alive at time of observation?</mat-hint>
                                    <mat-error *ngIf="this.alive?.invalid && this.alive?.errors?.required">This field is required.</mat-error>
                                </mat-form-field>
                            </div>

                        </div>

                    </div>

                    <!-- Sick or injured/Possession -->
                    <div
                        *ngIf="this.alive?.valid && this.alive?.value === this.refAlive"
                        [@animalAlive]="animalAlive"appHide
                        class="appFieldRow appHide"
                        fxLayout="row"
                        fxLayout.xs="column"
                        fxLayout.sm="column"
                        fxLayoutAlign="start center"
                        fxLayoutAlign.xs="start start"
                        fxLayoutAlign.sm="start start"
                        fxFlex>

                        <div
                        fxFlex="50"
                        fxFlex.xs="100"
                        fxFlex.sm="100"
                        class="appFormRowContainer">

                            <div class="appFormContainer">
                                <mat-form-field>
                                    <mat-label for="observation-sickOrInjured">Injured<span class="appRequiredAsterisk">*</span></mat-label>
                                    <mat-select id="observation-sickOrInjured" formControlName="sickOrInjured">
                                        <mat-option *ngFor="let item of this.yesNoList" [value]="item?.RefTableDataId">
                                            {{item?.Name}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-hint>Does animal appear to be sick or injured?</mat-hint>
                                    <mat-error *ngIf="this.sickOrInjured?.invalid && this.sickOrInjured?.errors?.required">This field is required.</mat-error>
                                </mat-form-field>
                            </div>

                        </div>

                        <div
                        fxFlex="50"
                        fxFlex.xs="100"
                        fxFlex.sm="100"
                        class="appFormRowContainer">

                            <div class="appFormContainer">
                                <mat-form-field>
                                    <mat-label for="observation-inYourPossession">Possession<span class="appRequiredAsterisk">*</span></mat-label>
                                    <mat-select id="observation-inYourPossession" formControlName="inYourPossession">
                                        <mat-option *ngFor="let item of this.yesNoList" [value]="item?.RefTableDataId">
                                            {{item?.Name}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-hint>Is the animal in your possession?</mat-hint>
                                    <mat-error *ngIf="this.inYourPossession?.invalid && this.inYourPossession?.errors?.required">This field is required.</mat-error>
                                </mat-form-field>
                            </div>

                        </div>

                    </div>

                    <!-- Poaching -->
                    <div
                        *ngIf="this.alive?.valid && this.alive?.value !== this.refAlive"
                        [@animalDead]="animalDead"
                        class="appFieldRow appHide"
                        fxLayout="row"
                        fxLayout.xs="column"
                        fxLayout.sm="column"
                        fxLayoutAlign="start center"
                        fxLayoutAlign.xs="start start"
                        fxLayoutAlign.sm="start start"
                        fxFlex>

                        <div
                            fxFlex="50"
                            fxFlex.xs="100"
                            fxFlex.sm="100"
                            class="appFormRowContainer">

                            <div class="appFormContainer">
                                <mat-form-field>
                                    <mat-label for="observation-poaching">Poaching<span class="appRequiredAsterisk">*</span></mat-label>
                                    <mat-select id="observation-poaching" formControlName="poaching">
                                        <mat-option *ngFor="let item of this.yesNoList" [value]="item?.RefTableDataId">
                                            {{item?.Name}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-hint>Is poaching suspected? <app-info-popup [title]="'Poaching'" [text]="this.messagePoaching"></app-info-popup></mat-hint>
                                    <mat-error *ngIf="this.poaching?.invalid && this.poaching?.errors?.required">This field is required.</mat-error>
                                </mat-form-field>
                            </div>

                        </div>

                    </div>

                    <!-- Age/Captive -->
                    <div
                        class="appFieldRow"
                        fxLayout="row"
                        fxLayout.xs="column"
                        fxLayout.sm="column"
                        fxLayoutAlign="start center"
                        fxLayoutAlign.xs="start start"
                        fxLayoutAlign.sm="start start"
                        fxFlex>

                        <div
                        fxFlex="50"
                        fxFlex.xs="100"
                        fxFlex.sm="100"
                        class="appFormRowContainer">

                            <div class="appFormContainer">
                                <mat-form-field>
                                    <mat-label for="observation-age">Age<span class="appRequiredAsterisk">*</span></mat-label>
                                    <mat-select id="observation-age" formControlName="age">
                                        <mat-option *ngFor="let item of this.ageList" [value]="item?.WildlifeAgeId">
                                            {{item?.Name}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-hint>What age is the majority of the wildlife?</mat-hint>
                                    <mat-error *ngIf="this.age?.invalid && this.age?.errors?.required">This field is required.</mat-error>
                                </mat-form-field>
                            </div>

                        </div>

                        <div
                        fxFlex="50"
                        fxFlex.xs="100"
                        fxFlex.sm="100"
                        class="appFormRowContainer">

                            <div class="appFormContainer">
                                <mat-form-field>
                                    <mat-label for="observation-captiveWild">Captive or Wild<span class="appRequiredAsterisk">*</span></mat-label>
                                    <mat-select id="observation-captiveWild" formControlName="captiveWild">
                                        <mat-option *ngFor="let item of this.captiveList" [value]="item?.OrigintId">
                                            {{item?.Name}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-hint>Is this a captive animal or a free-ranging wild animal? <app-info-popup [title]="'Captive or Wild'" [text]="this.messageCaptive"></app-info-popup></mat-hint>
                                    <mat-error *ngIf="this.captiveWild?.invalid && this.captiveWild?.errors?.required">This field is required.</mat-error>
                                </mat-form-field>
                            </div>

                        </div>

                    </div>

                    <!-- Zoonotic/Rabies -->
                    <div
                        class="appFieldRow"
                        fxLayout="row"
                        fxLayout.xs="column"
                        fxLayout.sm="column"
                        fxLayoutAlign="start center"
                        fxLayoutAlign.xs="start start"
                        fxLayoutAlign.sm="start start"
                        fxFlex>

                        <div
                        fxFlex="50"
                        fxFlex.xs="100"
                        fxFlex.sm="100"
                        class="appFormRowContainer">

                            <div class="appFormContainer">
                                <mat-form-field>
                                    <mat-label for="observation-zoonotic">Zoonotic Exposure<span class="appRequiredAsterisk">*</span></mat-label>
                                    <mat-select id="observation-zoonotic" formControlName="zoonotic">
                                        <mat-option *ngFor="let item of this.yesNoList" [value]="item?.RefTableDataId">
                                            {{item?.Name}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-hint>Were any people or domestic animals potentially exposed to any of the animals included in this report?</mat-hint>
                                    <mat-error *ngIf="this.zoonotic?.invalid && this.zoonotic?.errors?.required">This field is required.</mat-error>
                                </mat-form-field>
                            </div>

                        </div>

                        <div
                        *ngIf="this.species?.valid && this.speciesCodeIsMammal(this.species?.value)"
                        [@mammalSelected]="mammalSelected"
                        fxFlex="50"
                        fxFlex.xs="100"
                        fxFlex.sm="100"
                        class="appFormRowContainer appHide">

                            <div class="appFormContainer">
                                <mat-form-field>
                                    <mat-label for="observation-rabies">Rabies<span class="appRequiredAsterisk">*</span></mat-label>
                                    <mat-select id="observation-rabies" formControlName="rabies">
                                        <mat-option *ngFor="let item of this.yesNoList" [value]="item?.RefTableDataId">
                                            {{item?.Name}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-hint>Is rabies suspected? <app-info-popup [title]="'Rabies'" [text]="this.messageRabies"></app-info-popup></mat-hint>
                                    <mat-error *ngIf="this.rabies?.invalid && this.rabies?.errors?.required">This field is required.</mat-error>
                                </mat-form-field>
                            </div>

                        </div>

                    </div>

                    <!-- Spacer -->
                        <div
                        class="appFieldRow"
                        fxLayout="row"
                        fxLayout.xs="column"
                        fxLayout.sm="column"
                        fxLayoutAlign="start center"
                        fxLayoutAlign.xs="start start"
                        fxLayoutAlign.sm="start start"
                        fxFlex>

                        <mat-divider class="appFullWidth appSpacer"></mat-divider>

                    </div>

                    <!-- Details/Photos -->
                    <div
                        class="appFieldRow"
                        fxLayout="row"
                        fxLayout.xs="column"
                        fxLayout.sm="column"
                        fxLayoutAlign="center center"
                        fxLayoutAlign.xs="center center"
                        fxLayoutAlign.sm="center center"
                        fxFlex>

                        <div
                        fxFlex="100"
                        fxFlex.xs="100"
                        fxFlex.sm="100"
                        class="appFormRowContainer">

                            <div class="appFormContainer">
                                <mat-form-field id="appDetailsField">
                                    <mat-label for="observation-details">Additional Details</mat-label>
                                    <textarea
                                        id="observation-details"
                                        formControlName="details"
                                        matInput placeholder="Additional Details"></textarea>
                                    <mat-hint>Please describe what you observed, including details about the physical appearance and behavior of the animal(s) and the environment. What did each animal look like and what was it doing? What signs of illness or injury did you observe, if any? What time of day or night was your observation made? What was the weather like? Describe the location where the observation was made.</mat-hint>
                                    <mat-error *ngIf="this.details?.invalid && this.details?.errors?.maxLength">This field is limited to 1,500 characters.</mat-error>
                                </mat-form-field>
                            </div>

                        </div>

                    </div>

                    <!-- Photos -->
                    <div
                        class="appFieldRow"
                        fxLayout="row"
                        fxLayout.xs="column"
                        fxLayout.sm="column"
                        fxLayoutAlign="center center"
                        fxLayoutAlign.xs="center center"
                        fxLayoutAlign.sm="center center"
                        fxFlex>

                        <div
                        fxFlex="100"
                        fxFlex.xs="100"
                        fxFlex.sm="100"
                        class="appFormRowContainer">

                            <div class="appFormContainer appPhotoContainer">

                                <app-intro-helper-text
                                    [header]="this.photosHeader"
                                    [content]="this.photosContent"
                                ></app-intro-helper-text>

                                <app-file-upload (error)="this.openSnackBar($event)" (newData)="this.mediaDataChanged($event)"></app-file-upload>

                            </div>

                        </div>

                    </div>

                <!-- End Hidden Species -->
                </div>

            <!-- End Hidden Main -->
            </div>

        </div>

    </form>

</div>
